# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

This project is in early development stage. Currently, the core development files haven't been created yet. When ready, typical commands may include:
- `npm install` - Install dependencies
- `npm start` or `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm test` - Run tests

## Claude Rules
1. First think through the problem, read the codebase for relevant files, and write a plan
2. The plan should have a list of todo items that you can check off as you complete them
3. Before you begin working, check in with me and I will verify the plan
4. Then, begin working on the todo items, marking them as complete as you go
5. Please every step of the way just give me a high level explanation of what changes you made
6. Make every task and code change you do as simple as possible. We want to avoid making any massive or complex changes. Every change should impact as little code as possible. Everything is about simplicity
7. Always answer in Chinese!
8. Never try to stop/start server!



## Project requirement
本web工程是一个虚拟漫游应用程序, 基于数据, 为一个房屋空间自动生成虚拟漫游的体验(用户交互的体验和Matterport能提供的一样). 它可以加载`data/sample-space`目录下的数据, 包括多张equirectangular全景图(`data/sample-space/frames`), 定义了每一张全景图的拍摄位置的配置文件(`data/sample-space/cameras.xml`), 一个该空间的三维模型文件(`data/sample-space/models.glb`)及其纹理文件(`data/sample-space/texture.jpg`).

所有的全景图是equirectangular, 来自房屋的全景视频的抽帧, `cameras.xml`是在Metashape中, 以这些全景图作为input, 跑一个SfM(structure-from-motion)生成的.

请你仔细思考应该使用什么工具,技术,框架来实现这个项目, 下面是具体的一些需求.

1. 有两种view, 应用和程序刚刚launch的时候是bird-view, 进入panoramic-view之后按‘Esc’键可以退回到bird-view.
- `bird-view`: 用户launch应用程序首先看到的该房屋的三维模型的`bird-view`, 在bird-view中能看到所有全景图的拍摄节点(可视化为一个一个的相机球体, 或者地面上的圆圈).
- `panoramic-view`: 用户点击其中任意一个相机球体或地面上的圆圈就能打开相应的全景图, 在全景图中也能看到其他的拍摄点位置(也是相机球体或地面上的圆圈),点击任何一个teal球体用户可以切换到下一站全景图, 切换的过程有很好的过渡动画(第一张全景图先zoom in, 同时fade out, 第二张全景图从zoom out恢复, 同时fade in,像真正在空间中前进一样). 我希望现有的工具已经实现了这样的过渡动画效果.

2. `节点`/`拍摄节点`: 用户在漫游过程中(的每个全景图所在的本地空间中的位置就是一个节点,整个漫游过程就是用户在panoramic-view中,在各个节点之间跳来跳去(过程很平滑,有过渡效果,像真正前进一样)

考虑上述需求, 仔细认真思考我应该用什么工具实现, 最要找现有的框架和工具, 比如‘Marzipano’和‘Panolens.js’, 可能可以基于Marzipano来开发本工程, 也可以参考'Panolens.js'(但该项目已经被废弃了比较老了)


## Available Frameworks & References

**Recommended frameworks for 360° panoramic viewers:**

### Marzipano (`ref/marzipano/`)
- Google's 360° media viewer framework
- Full source code available locally
- Key features: cube/equirectangular panoramas, hotspots, multi-resolution
- Demo examples in `ref/marzipano/demos/`
- Well-suited for this project's requirements

### Panolens.js (`ref/panolens.js/`)  
- Three.js-based panoramic viewer
- Full source code available locally
- Key features: various panorama types, VR support, transitions
- TypeScript definitions available
- Examples in `ref/panolens.js/example/`

### Documentation
- `doc/metashape-pro_2_1_en.pdf`: Metashape官方文档，用于理解`cameras.xml`数据结构
- `doc/metashape_python_api_2_1_3.pdf`: Metashape Python API文档


## Project Architecture

### Core Concept
This is a 3D virtual space browser built with React + Three.js, featuring:
- **Bird-view mode**: 3D scene with clickable camera positions
- **Panoramic mode**: Full-screen panoramic view from selected camera positions

### Data File Management

**Critical**: This project uses a unique data file system:

1. **Source data** lives in `data/sample-space/`:
   - `model.glb` - 3D model file  
   - `texture.jpg` - Texture file
   - `cameras.xml` - Camera position metadata generated by Metashape SfM (structure-from-motion), containing:
     - Camera transforms and positions for each panoramic image
     - Sensor information (GoPro Max 360° spherical)
     - Rotation and location covariance data
   - `frames/` - 15 equirectangular panoramic image frames (1_frame_1.JPG through 1_frame_15.JPG)

2. **Runtime data** needs to be copied to `public/data/` for web access
3. **Both directories should be ignored by git** to avoid large file commits  
4. **Copy script** will need to be created to handle file synchronization during development

### Camera Data Structure

The `cameras.xml` file contains:
- Sensor definition for GoPro Max (5760x2880 resolution)
- Camera positions with 4x4 transformation matrices
- Each camera entry corresponds to a panoramic frame
- Coordinate system and positioning data from Metashape photogrammetry
